import math
from timeit import timeit
from random import random

#class illum:
#    __init__(self,X,Y,Z,x,y,u,v,v`)

illuminant = {
    'A'  :{'X':1.09850,'Y':1.00000,'Z':0.35585,'x':0.44757,'y':0.40744,'u':0.25597,'v':0.34953,'v`':0.52429},
    'B'  :{'X':0.99072,'Y':1.00000,'Z':0.85223,'x':0.34848,'y':0.35175,'u':0.21366,'v':0.32350,'v`':0.48524},
    'C'  :{'X':0.98074,'Y':1.00000,'Z':1.18232,'x':0.31006,'y':0.31615,'u':0.20089,'v':0.30726,'v`':0.46088},
    'd50':{'X':0.96422,'Y':1.00000,'Z':0.82521,'x':0.34567,'y':0.35850,'u':0.20916,'v':0.32538,'v`':0.48807},
    'd55':{'X':0.95682,'Y':1.00000,'Z':0.92149,'x':0.33242,'y':0.34743,'u':0.20443,'v':0.32049,'v`':0.48074},
    'd60':{'X':0.95230,'Y':1.00000,'Z':1.00859,'x':0.32163,'y':0.33774,'u':0.20072,'v':0.31615,'v`':0.47423},
    'd65':{'X':0.95047,'Y':1.00000,'Z':1.08883,'x':0.31273,'y':0.32902,'u':0.19784,'v':0.31222,'v`':0.46834},
    'd75':{'X':0.94972,'Y':1.00000,'Z':1.22638,'x':0.29902,'y':0.31485,'u':0.19354,'v':0.30567,'v`':0.45851},
    'e'  :{'X':1.00000,'Y':1.00000,'Z':1.00000,'x':0.33333,'y':0.33333,'u':0.21053,'v':0.31579,'v`':0.47368},
    'f1' :{'X':0.92834,'Y':1.00000,'Z':1.03665,'x':0.31310,'y':0.33727,'u':0.19505,'v':0.31515,'v`':0.47273},
    'f2' :{'X':0.99145,'Y':1.00000,'Z':0.67316,'x':0.37208,'y':0.37529,'u':0.22019,'v':0.33313,'v`':0.49970},
    'f3' :{'X':1.03753,'Y':1.00000,'Z':0.49861,'x':0.40910,'y':0.39430,'u':0.23670,'v':0.34220,'v`':0.51331},
    'f4' :{'X':1.09147,'Y':1.00000,'Z':0.38813,'x':0.44018,'y':0.40329,'u':0.25301,'v':0.34771,'v`':0.52156},
    'f5' :{'X':0.90872,'Y':1.00000,'Z':0.98723,'x':0.31379,'y':0.34531,'u':0.19262,'v':0.31796,'v`':0.47694},
    'f6' :{'X':0.97309,'Y':1.00000,'Z':0.60191,'x':0.37790,'y':0.38835,'u':0.21893,'v':0.33748,'v`':0.50622},
    'f7' :{'X':0.95017,'Y':1.00000,'Z':1.08630,'x':0.31292,'y':0.32933,'u':0.19786,'v':0.31235,'v`':0.46853},
    'f8' :{'X':0.96413,'Y':1.00000,'Z':0.82333,'x':0.34588,'y':0.35875,'u':0.20920,'v':0.32548,'v`':0.48823},
    'f9' :{'X':1.00365,'Y':1.00000,'Z':0.67868,'x':0.37417,'y':0.37281,'u':0.22254,'v':0.33260,'v`':0.49890},
    'f10':{'X':0.96174,'Y':1.00000,'Z':0.81712,'x':0.34609,'y':0.35986,'u':0.20892,'v':0.32585,'v`':0.48878},
    'f11':{'X':1.00899,'Y':1.00000,'Z':0.64262,'x':0.38052,'y':0.37713,'u':0.22501,'v':0.33451,'v`':0.50176},
    'f12':{'X':1.08046,'Y':1.00000,'Z':0.39228,'x':0.43695,'y':0.40441,'u':0.25044,'v':0.34768,'v`':0.52152}}

def xyz2(rgb):
    r = ((rgb[0]+0.055)/1.055)**2.4 if rgb[0]>0.04045 else rgb[0]/12.92
    g = ((rgb[1]+0.055)/1.055)**2.4 if rgb[1]>0.04045 else rgb[1]/12.92
    b = ((rgb[2]+0.055)/1.055)**2.4 if rgb[2]>0.04045 else rgb[2]/12.92
    return (
		0.4124564*r+0.3575761*g+0.1804375*b,
		0.2126729*r+0.7151522*g+0.0721750*b,
		0.0193339*r+0.1191920*g+0.9503041*b)

def rgb(xyz):
    xyz = (
    	3.2404542*xyz[0]-1.5371385*xyz[1]-0.4985314*xyz[2],
    	-0.969266*xyz[0]+1.8760108*xyz[1]+0.0415560*xyz[2],
    	0.0556434*xyz[0]-0.2040259*xyz[1]+1.0572252*xyz[2])
    return (
        1.055*xyz[0]**0.41666666666-0.055 if xyz[0]>0.0031308 else xyz[0]*12.92,
        1.055*xyz[1]**0.41666666666-0.055 if xyz[1]>0.0031308 else xyz[1]*12.92,
        1.055*xyz[2]**0.41666666666-0.055 if xyz[2]>0.0031308 else xyz[2]*12.92)

def uvw(xyz):
    if xyz[1] == 0: return (0,0,0)
    xyz = (
    4*xyz[0]/(xyz[0]+15*xyz[1]+3*xyz[2]),
    25*xyz[1]**0.333333333333,
    6*xyz[1]/(xyz[0]+15*xyz[1]+3*xyz[2]))
    return (
    xyz[1]*(xyz[0]-0.19784),
    xyz[1]*(xyz[2]-0.31222),
    xyz[1])

def _uvw(uvw):
    if uvw[2] == 0: return (0,0,0)
    uvw = (
    uvw[0]/uvw[2]+0.19784,
    uvw[1]/uvw[2]+0.31222,
    uvw[2]**3/25.)
    return (
    1.5*uvw[0]*uvw[2]/uvw[1],
    uvw[2],
    (2-0.5*uvw[0]-5*uvw[1])*uvw[2]/uvw[1])

def luv(xyz):
    if xyz[1] == 0: return (0,0,0)
    L = (116*xyz[1]**0.333333333333-16 if xyz[1]>0.00885645167 else 903.296296296*xyz[1])
    s = xyz[0]+15*xyz[1]+3*xyz[2]
    return (
	    L,
	    13*L*(4*xyz[0]/s-0.19784),
	    13*L*(9*xyz[1]/s-0.46834))

def _luv(luv):
    if luv[0] == 0: return (0,0,0)
    luv = (
        (((luv[0]+16)/116)**3 if luv[0]>8 else luv[0]*0.00110705645),
        luv[1]/(13*luv[0])+0.19784,
        luv[2]/(13*luv[0])+0.46834)
    return (
        2.25*luv[0]*luv[1]/luv[2],
        luv[0],
        luv[0]*(3-0.75*luv[1]-5*luv[2])/luv[2])

def lab(xyz):
    xyz = (
        xyz[0]/0.95047,
        xyz[1],
        xyz[2]/1.08883)
    xyz = (
        xyz[0]**0.333333333333 if xyz[0]>0.00885645167 else xyz[0]/0.12841854934+0.13793103448,
        xyz[1]**0.333333333333 if xyz[1]>0.00885645167 else xyz[1]/0.12841854934+0.13793103448,
        xyz[2]**0.333333333333 if xyz[2]>0.00885645167 else xyz[2]/0.12841854934+0.13793103448)
    return (
        116*xyz[1]-16,
        500*(xyz[0]-xyz[1]),
        200*(xyz[1]-xyz[2]))

def lab2(xyz):
    '''x = xyz[0]/0.95047
    z = xyz[2]/1.08883
    xyz = (
        x**0.333333333333 if x>0.00885645167 else x/0.12841854934+0.13793103448,
        xyz[1]**0.333333333333 if xyz[1]>0.00885645167 else xyz[1]/0.12841854934+0.13793103448,
        z**0.333333333333 if z>0.00885645167 else z/0.12841854934+0.13793103448)
    return (
        116*xyz[1]-16,
        500*(xyz[0]-xyz[1]),
        200*(xyz[1]-xyz[2]))'''
    #x = xyz[0]/0.95047; x = x**0.333333333333 if x>0.00885645167 else x/0.12841854934+0.13793103448
    #y = xyz[1]**0.333333333333 if xyz[1]>0.00885645167 else xyz[1]/0.12841854934+0.13793103448
    #z = xyz[2]/1.08883; z = z**0.333333333333 if z>0.00885645167 else z/0.12841854934+0.13793103448
    x = (xyz[0]/0.95047)**0.333333333333 if xyz[0]>0.00931797076 else xyz[0]/0.12205797859+0.13793103448
    y = xyz[1]**0.333333333333 if xyz[1]>0.00885645167 else xyz[1]/0.12841854934+0.13793103448
    z = (xyz[2]/1.08883)**0.333333333333 if xyz[2]>0.00813391591 else xyz[2]/0.13982596907+0.13793103448
    return (
        116*y-16,
        500*(x-y),
        200*(y-z))

def lab3(xyz):
    '''x = xyz[0]/0.95047
    z = xyz[2]/1.08883
    xyz = (
        x**0.333333333333 if x>0.00885645167 else x/0.12841854934+0.13793103448,
        xyz[1]**0.333333333333 if xyz[1]>0.00885645167 else xyz[1]/0.12841854934+0.13793103448,
        z**0.333333333333 if z>0.00885645167 else z/0.12841854934+0.13793103448)
    return (
        116*xyz[1]-16,
        500*(xyz[0]-xyz[1]),
        200*(xyz[1]-xyz[2]))'''
    x = xyz[0]/0.95047; x = x**0.333333333333 if x>0.00885645167 else x/0.12841854934+0.13793103448
    y = xyz[1]**0.333333333333 if xyz[1]>0.00885645167 else xyz[1]/0.12841854934+0.13793103448
    z = xyz[2]/1.08883; z = z**0.333333333333 if z>0.00885645167 else z/0.12841854934+0.13793103448
    return (
        116*y-16,
        500*(x-y),
        200*(y-z))

def lab4(xyz):
    '''x = xyz[0]/0.95047
    z = xyz[2]/1.08883
    xyz = (
        x**0.333333333333 if x>0.00885645167 else x/0.12841854934+0.13793103448,
        xyz[1]**0.333333333333 if xyz[1]>0.00885645167 else xyz[1]/0.12841854934+0.13793103448,
        z**0.333333333333 if z>0.00885645167 else z/0.12841854934+0.13793103448)
    return (
        116*xyz[1]-16,
        500*(xyz[0]-xyz[1]),
        200*(xyz[1]-xyz[2]))'''
    x = xyz[0]; x = (x/0.95047)**0.333333333333 if x/0.95047>0.00885645167 else x/0.95047/0.12841854934+0.13793103448
    y = xyz[1]**0.333333333333 if xyz[1]>0.00885645167 else xyz[1]/0.12841854934+0.13793103448
    z = xyz[2]/1.08883; z = z**0.333333333333 if z>0.00885645167 else z/0.12841854934+0.13793103448
    return (
        116*y-16,
        500*(x-y),
        200*(y-z))

def _lab(lab):
    L = (lab[0]+16)/116
    lab = (
        L,
        lab[1]/500+L,
        lab[0]/200-L)
    return (
        (0.95047*lab[1]**3 if lab[1]>0.20689655172 else 0.12205797859*(lab[1]-0.13793103448)),
        lab[0]**3 if lab[0]>0.20689655172 else 0.12841854934*(lab[0]-0.13793103448),
        (1.08883*lab[2]**3 if lab[2]>0.20689655172 else 0.13982596907*(lab[2]-0.13793103448)))

def _lab2(lab):
    l = (lab[0]+16)/116
    a = lab[1]/500+l
    b = lab[0]/200-l
    return (
        (0.95047*a**3 if a>0.20689655172 else 0.12205797859*(a-0.13793103448)),
        l**3 if l>0.20689655172 else 0.12841854934*(l-0.13793103448),
        (1.08883*b**3 if b>0.20689655172 else 0.13982596907*(b-0.13793103448)))

def hlab(xyz):
    if xyz[1] == 0: return (0,0,0)
    xyz = (
        xyz[0]/0.95047-xyz[1],
        math.sqrt(xyz[1]),
        xyz[1]-xyz[2]/1.08883)
    return (
        100*xyz[1],
        172.3*xyz[0]/xyz[1],
        67.2*xyz[2]/xyz[1])

def _hlab(lab):
    lab = (
        (lab[0]/100)**2,
        lab[1]*lab[0]/17230.,
        lab[2]*lab[0]/6720.)
    return (
        0.95047*(lab[1]+lab[0]),
        lab[0],
        -1.08883*(lab[2]-lab[0]))

def rtime(f1, *fn):
    random()
    t1 = timeit(f1+'((0.5,0.5,0.3))','from __main__ import '+f1)
    print str(round(t1,6))+' s'
    times = [timeit(f+'((0.5,0.5,0.3))','from __main__ import '+f) for f in fn]
    for time in times:
        print str(round(time,6))+' s; '+str(int(time/t1*100-99.5))+' per cent'

rtime('lab3','lab4')
#print lab((0.5,0.5,0.3))
#print lab2((0.5,0.5,0.3))
